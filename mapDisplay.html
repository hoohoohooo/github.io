<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>간단한 지도 표시하기</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- ncpClientId는 등록 환경에 따라 일반(ncpClientId), 공공(govClientId), 금융(finClientId)으로 나뉩니다. 사용하는 환경에 따라 키 이름을 변경하여 사용하세요. 참고: clientId(네이버 개발자 센터)는 지원 종료 -->
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=mtvq1t3xt6"></script>
</head>
<body>
<style type="text/css">
.speech-bubble {
  position: relative;
	background: #6e7272;
	border-radius: .4em;
    min-width:100px;
    text-align:center;
    color:white;
    left:-41.5px;
	transition: all 0.2s;
}

.speech-bubble:after {
  content: '';
	position: absolute;
	bottom: 0;
	left: 50%;
	width: 0;
	height: 0;
	border: 11px solid transparent;
	border-top-color: #6e7272;
	border-bottom: 0;
	margin-left: -11px;
	margin-bottom: -10px;
}

.speech-bubble:focus{
    background:#ffffff;
    color: black;
}

.renderlayertestParent{
    position: relative;
    z-index: 0;
    background: gold;
    width: 100%;
    height: 98vh;
}

.renderlayertestChild{
    position: absolute;
    z-index: 1;
    bottom: 3em;
    width: 80%;
    height: 50px;
    background-color: #555555;
    color: #FFFFFF;
    border-radius: .4em;
    display: none;
    margin-left: 10%;
    margin-right: 10%;
    text-align: right;
}
.discountAmtCSS{
	color: red;
}
.minPriceCSS{
	font-size: 8px;
	text-decoration: line-through;
}
.actualPriceCSS{
	font-size: 12px;
}
	
</style>
<!-- @category Map -->
<div id="map" class="renderlayertestParent"></div>
<button id="shopFocusBtn" class="renderlayertestChild">tmp</button>
<div id="wrap" class="section">
    <h2>간단한 지도 표시하기</h2>
    <p>지도를 생성하는 가장 기본적인 예제입니다. 지도 옵션을 설정하지 않으면 다음과 같이 서울 시청을 중심으로 하는 지도가 생성됩니다.</p>
    <code id="snippet" class="snippet"></code>
</div>
<script id="code">
//지도를 삽입할 HTML 요소 또는 HTML 요소의 id를 지정합니다.
//var mapDiv = document.getElementById('map'); // 'map'으로 선언해도 동일
var map;
//loadMap('35.16\t129.12');

//var position = new naver.maps.LatLng(37.3595704, 127.105399);
//옵션 없이 지도 객체를 생성하면 서울 시청을 중심으로 하는 16 레벨의 지도가 생성됩니다.
//var map = new naver.maps.Map(mapDiv,{
//    center: position,
//    zoom: 15
//});
//var marker = new naver.maps.Marker({
//    position: position,
//    map: map
//});

//console.log(map.getCenter())
//const currentUrl = window.location.href;
//console.log(currentUrl);
//naver.maps.Event.addListener(map, 'tap', function(e) {
//    marker.setPosition(e.coord);
//    location.href = "uniwebview://action?key=value&anotherKey=anotherValue";
//});
    //loadMap();
    function loadMap(phonePosDataStr, jsonStr){
        location.href = "uniwebview://showing map...";
        var phonePos = phonePosDataStr.split("\t");
        //var x = parsFloat(phonePos[0]);
        //var y = parsFloat(phonePos[1]);
        var position = new naver.maps.LatLng(phonePos[0],phonePos[1]);
        var map = new naver.maps.Map(mapDiv,{
            center: position,
            zoom: 15
        });
        location.href = "uniwebview://showing map successful";
        location.href = "uniwebview://placing markers...";
        var shops = jsonStr.split("\n");
        var markers = [];
        for(let i = 0;i<shops.length;i++){
            var infoArr = shops[i].split("\t");
            console.log(infoArr[0]);
            var tmpMarker = new naver.maps.Marker({
                position: new naver.maps.LatLng(infoArr[1],infoArr[2]),
                map: map,
                title: shops[0]
            });
            naver.maps.Event.addListener(tmpMarker,"click",function(e){
                location.href = "uniwebview://" + tmpMarker.title;
            });
            markers.push(tmpMarker);
        }
    }

    function loadMap(){
        location.href = "uniwebview://showing map...0";
        var mapDiv = document.getElementById('map'); 
        location.href = "uniwebview://showing map...1";
        var position = new naver.maps.LatLng(37.3595704, 127.105399);
        location.href = "uniwebview://showing map...2";
        map = new naver.maps.Map(mapDiv,{
        center: position,
        zoom: 15
        });
        location.href = "uniwebview://showing map...3";
    }

    function setCenter(str){
        location.href = "uniwebview://setting center..." + "to " + str;
        var posArr = str.split('@');
        var position = new naver.maps.LatLng(posArr[0],posArr[1]);
        map.setCenter(position);
    }
    function uniWebViewCommunicationTest(str){
        location.href = "uniwebview://" + str;
    }
    function setMarker(str){
        var infoArr = str.split('\t');
	location.href = "uniwebview://" +infoArr[3];
        var tmpMarker = new naver.maps.Marker({
                position: new naver.maps.LatLng(infoArr[1],infoArr[2]),
                map: map,
                title: infoArr[0],
                icon: {
                    content: [
                        '<div class="wrap">',
                            '<button class="speech-bubble">'+infoArr[3]+'</button>',
                        '</div>'
                    ].join(''),
                    size: new naver.maps.Size(22, 35),
                    anchor: new naver.maps.Point(11, 35)
                    }
            });
        naver.maps.Event.addListener(tmpMarker,"click",function(e){
                location.href = "uniwebview://markerClickAnswer" + tmpMarker.title;
            });
            
    }
	var btnVisible = false;
function gettingShopInfo(str){
	location.href = "uniwebview://"+" " +(btnVisible==false);
	var arr = str.split('\t');
	location.href = "uniwebview:// 0 "+" " + arr[0];
	location.href = "uniwebview:// 1 "+" " + arr[1];
	location.href = "uniwebview:// 2 "+" " + arr[2];
	//discountAmt -> minPrice -> actualPrice -> shopid;
	if(btnVisible===true){
		$("#shopFocusBtn").fadeOut("1",function(){
			location.href = "uniwebview://startingGetting" + btnVisible;
			let btn=document.getElementById("shopFocusBtn");
			//btn.innerHTML = str;
			btn.innerHTML = "<br><span class=\"discountAmtCSS\">"+ arr[0] + "%</span>\t" + "<span class=\"minPriceCSS\">" + arr[1] + "</span>\n</br>" + "<span class=\"actualPriceCSS\">" + arr[2] + "</span>";
			console.log("???");
			btnVisible = true;
			$("#shopFocusBtn").fadeIn();
		});
	}
	if(btnVisible===false){
		location.href = "uniwebview://startingGetting" + btnVisible;
		let btn=document.getElementById("shopFocusBtn");
		//btn.innerHTML = str;
		btn.innerHTML = "<span class=\"discountAmtCSS\">"+ arr[0] + "%</span>\t" + "<span class=\"minPriceCSS\">" + arr[1] + "</span>\n</br>" + "<span class=\"actualPriceCSS\">" + arr[2] + "</span>";
		console.log("???");
		btnVisible = true;
		$("#shopFocusBtn").fadeIn();
	}
}
var testBool = false;
	
function showFocusBtn(){
	$("#shopFocusBtn").fadeIn();
}
</script>

</body>
</html>
